# @title ğŸ”§ 1. è¡¥é½æ ¸å¿ƒä¾èµ– (ä¿®å¤ Python 3.12 å…¼å®¹æ€§)
%cd /content/GPT-SoVITS

# å®‰è£…ç¼ºå¤±çš„æ ¸å¿ƒå¤„ç†åº“ï¼ˆè·³è¿‡æŠ¥é”™çš„ openccï¼‰
!pip install pypinyin sentencepiece transformers librosa==0.10.1 opencc-python-reimplemented
!pip install einops rotary_embedding_torch ffmpeg-python

# å¼ºåˆ¶å®‰è£… GPU ç‰ˆ Torch (ç¡®ä¿äº‘ç«¯ T4 æ˜¾å¡è¢«æ­£ç¡®è°ƒç”¨)
!pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu121

print("âœ… ä¾èµ–è¡¥æ•‘å®Œæˆï¼Œå¯ä»¥å¯åŠ¨ï¼")

# @title ğŸš€ 2. å¯åŠ¨æ¨ç†ç•Œé¢ (è·å–å…¬ç½‘é“¾æ¥)
import os
%cd /content/GPT-SoVITS

# 1. è‡ªåŠ¨è¿ç§»æ¨¡å‹æƒé‡ (å¦‚æœå·²ä¸‹è½½)
!mkdir -p GPT_SoVITS/pretrained_models
if os.path.exists("/content/GPT-SoVITS/pretrained_models_download"):
    !cp -r /content/GPT-SoVITS/pretrained_models_download/* /content/GPT-SoVITS/GPT_SoVITS/pretrained_models/ 2>/dev/null
    print("âœ… é¢„è®­ç»ƒæ¨¡å‹å·²éƒ¨ç½²åˆ°ä½")

# 2. å¯åŠ¨ä¸»ç¨‹åº
# --share: å¿…é¡»å¼€å¯ï¼Œå¦åˆ™æœ¬åœ° Mac æ— æ³•è®¿é—®
# --is_half 1: å¼€å¯åŠç²¾åº¦ï¼ŒåŠ å¿«é€Ÿåº¦å¹¶èŠ‚çœæ˜¾å­˜
!python webui.py --share --is_half 1

# å°†æ¨¡å‹ä¿å­˜åˆ°ä½ çš„ Google Driveï¼Œä¸‹æ¬¡ç›´æ¥ä»ç½‘ç›˜è¯»å–
from google.colab import drive
drive.mount('/content/drive')
!cp -r /content/GPT-SoVITS/pretrained_models_download /content/drive/MyDrive/GPT-SoVITS-Models

# @title ğŸš€ ç‚¹å‡»è¿è¡Œï¼Œè·å–æ¨ç†é“¾æ¥
%cd /content/GPT-SoVITS

# 1. ç¡®ä¿é¢„è®­ç»ƒæ¨¡å‹å·²ç»åœ¨æ­£ç¡®ä½ç½®
!mkdir -p GPT_SoVITS/pretrained_models
!cp -r /content/GPT-SoVITS/pretrained_models_download/* /content/GPT-SoVITS/GPT_SoVITS/pretrained_models/ 2>/dev/null || echo "Models already OK"

# 2. å¯åŠ¨ WebUI
# --share ä¼šç”Ÿæˆä¸€ä¸ª .gradio.live çš„å…¬ç½‘é“¾æ¥
# --is_half 1 ä½¿ç”¨åŠç²¾åº¦ï¼Œèƒ½è®©äº‘ç«¯æ˜¾å¡è·‘å¾—æ›´é¡ºæ»‘
!python webui.py --share --is_half 1
